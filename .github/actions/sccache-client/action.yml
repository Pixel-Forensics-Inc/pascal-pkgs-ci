name: Configure `sccache` client

runs:
  using: "composite"

  steps:
    - name: Execute `tailscale` command
      shell: bash
      run: scripts/tailscale.sh up --authkey=${{ env.TS_AUTH_KEY }} --hostname=${{ env.TS_HOSTNAME }} --ssh

    - name: Set environment variables
      shell: bash
      run: |
        echo "SCCACHE_GHA_ENABLED=1" | tee -a "$GITHUB_ENV"
        echo "SCCACHE_DIRECT=1"      | tee -a "$GITHUB_ENV"

    - name: Install sccache
      uses: mozilla-actions/sccache-action@v0.0.5

    - name: Wait indefinitely (almost)
      shell: bash
      run: sleep 86400

    - if: always()
      name: Execute `tailscale` command
      shell: bash
      run: scripts/tailscale.sh logout
